# Dockerfile for testing with PATCHED Java RPM (Rocky 9)
FROM rockylinux:9

# Install locale support
RUN dnf install -y glibc-langpack-en && dnf clean all

ENV LANG=en_US.UTF-8 LC_ALL=en_US.UTF-8

# Copy and install PATCHED RPMs
COPY java-11-openjdk-headless-*.el9.x86_64.rpm /tmp/
COPY java-11-openjdk-devel-*.el9.x86_64.rpm /tmp/
RUN dnf install -y /tmp/*.rpm && rm -f /tmp/*.rpm && dnf clean all

# Compile POC
WORKDIR /poc/src
COPY src/*.java ./
RUN javac -encoding UTF-8 *.java

ENV JAVA_HOME=/usr/lib/jvm/java-11-openjdk PATH=/usr/lib/jvm/java-11-openjdk/bin:$PATH
CMD ["java", "TLSReflectionPoC"]
