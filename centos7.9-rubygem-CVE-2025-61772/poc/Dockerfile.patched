FROM ruby:2.7-alpine

WORKDIR /app

# Copy the patched gem (built from CVE-2025-61772-complete-fix.patch)
COPY rack-2.0.9.1-complete-fix.gem /app/

# Install the patched rack gem
RUN gem install /app/rack-2.0.9.1-complete-fix.gem

# Copy the test application
COPY vulnerable_app.rb /app/

# Expose port
EXPOSE 9292

# Run the application with patched Rack
CMD ["ruby", "vulnerable_app.rb"]
