# Dockerfile for testing with PATCHED Java RPM (Rocky 8)
FROM rockylinux:8

# Install locale support
RUN dnf install -y glibc-langpack-en && \
    dnf clean all

# Set locale for UTF-8 support
ENV LANG=en_US.UTF-8 \
    LC_ALL=en_US.UTF-8

# Copy the PATCHED RPMs
COPY java-11-openjdk-headless-*.el8.x86_64.rpm /tmp/
COPY java-11-openjdk-devel-*.el8.x86_64.rpm /tmp/

# Install the PATCHED Java RPMs
RUN echo "Installing PATCHED Java 11 for Rocky 8 with CVE-2025-21587 fix..." && \
    dnf install -y /tmp/java-11-openjdk-headless-*.rpm /tmp/java-11-openjdk-devel-*.rpm && \
    rm -f /tmp/*.rpm && \
    dnf clean all

# Copy and compile POC source files
WORKDIR /poc/src
COPY src/*.java ./
RUN javac -encoding UTF-8 *.java && ls -la *.class

# Set Java environment
ENV JAVA_HOME=/usr/lib/jvm/java-11-openjdk \
    PATH=/usr/lib/jvm/java-11-openjdk/bin:$PATH

# Create results directory
RUN mkdir -p /poc/results

# Show Java version
RUN echo "Installed Java version:" && java -version

# Default command: Run TLSReflectionPoC
WORKDIR /poc/src
CMD ["java", "TLSReflectionPoC"]
